// Suppression des scripts inutiles, minification, lazy loading JS si nécessaire

// Lazy loading polyfill pour anciens navigateurs
if(!('loading'in HTMLImageElement.prototype)){
  document.querySelectorAll('img[loading="lazy"]').forEach(function(img){
    img.src=img.dataset.src||img.src;
  });
}
// Ajout loaded class pour fade-in
document.addEventListener('DOMContentLoaded',function(){
  document.querySelectorAll('img[loading="lazy"]').forEach(function(img){
    if(img.complete){img.classList.add('loaded');}
    else{img.addEventListener('load',function(){img.classList.add('loaded');});}
  });
  // Skip link focus fix
  var skip=document.querySelector('.skip-link');
  if(skip){skip.addEventListener('click',function(){var main=document.getElementById('main-content');if(main)main.setAttribute('tabindex','-1');main.focus();});}
  // Ajout d'attributs ARIA dynamiques pour le slider de témoignages
  var slider = document.querySelector('.testimonials-slider');
  if(slider){slider.setAttribute('aria-live','polite');}
  // FAQ ARIA
  document.querySelectorAll('.faq-question').forEach(function(q){
    q.setAttribute('tabindex','0');
    q.setAttribute('role','button');
    q.setAttribute('aria-expanded','false');
    q.addEventListener('click',function(){
      var expanded = q.getAttribute('aria-expanded')==='true';
      q.setAttribute('aria-expanded',!expanded);
    });
    q.addEventListener('keydown',function(e){
      if(e.key==='Enter'||e.key===' '){q.click();}
    });
  });
  var mobileMenu=document.querySelector('.mobile-menu');
  var navLinks=document.getElementById('navLinks');
  if(mobileMenu&&navLinks){
    mobileMenu.addEventListener('click',function(e){
      navLinks.classList.toggle('active');
      mobileMenu.classList.toggle('active');
      document.body.style.overflow=navLinks.classList.contains('active')?'hidden':'auto';
      if(navLinks.classList.contains('active')){
        navLinks.querySelector('a').focus();
      }
    });
    // Ferme le menu au scroll ou tap hors menu
    document.addEventListener('click',function(e){
      if(navLinks.classList.contains('active')&&!mobileMenu.contains(e.target)&&!navLinks.contains(e.target)){
        navLinks.classList.remove('active');
        mobileMenu.classList.remove('active');
        document.body.style.overflow='auto';
      }
    });
    window.addEventListener('scroll',function(){
      if(navLinks.classList.contains('active')){
        navLinks.classList.remove('active');
        mobileMenu.classList.remove('active');
        document.body.style.overflow='auto';
      }
    });
    // Accessibilité clavier mobile
    navLinks.querySelectorAll('a').forEach(function(link){
      link.addEventListener('keydown',function(e){
        if(e.key==='Escape'){
          navLinks.classList.remove('active');
          mobileMenu.classList.remove('active');
          document.body.style.overflow='auto';
          mobileMenu.focus();
        }
      });
    });
  }
  // Ajout aria-label sur boutons dynamiques si besoin
  document.querySelectorAll('button, .btn').forEach(function(btn){
    if(!btn.getAttribute('aria-label')&&btn.textContent.trim().length>0){
      btn.setAttribute('aria-label',btn.textContent.trim());
    }
  });
});