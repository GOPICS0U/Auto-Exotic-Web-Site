// Suppression des scripts inutiles, minification, lazy loading JS si nécessaire

// Lazy loading polyfill pour anciens navigateurs
if(!('loading'in HTMLImageElement.prototype)){
  document.querySelectorAll('img[loading="lazy"]').forEach(function(img){
    img.src=img.dataset.src||img.src;
  });
}
// Ajout loaded class pour fade-in (évite CLS sur lazy load)
document.addEventListener('DOMContentLoaded',function(){
  document.querySelectorAll('img[loading="lazy"]').forEach(function(img){
    if(img.complete){img.classList.add('loaded');}
    else{img.addEventListener('load',function(){img.classList.add('loaded');});}
  });
  // Skip link focus fix pour accessibilité clavier
  var skip=document.querySelector('.skip-link');
  if(skip){skip.addEventListener('click',function(){var main=document.getElementById('main-content');if(main)main.setAttribute('tabindex','-1');main.focus();});}
  // Menu mobile accessibilité et fermeture auto
  var mobileMenu=document.querySelector('.mobile-menu');
  var navLinks=document.getElementById('navLinks');
  if(mobileMenu&&navLinks){
    mobileMenu.addEventListener('click',function(e){
      navLinks.classList.toggle('active');
      mobileMenu.classList.toggle('active');
      document.body.style.overflow=navLinks.classList.contains('active')?'hidden':'auto';
      if(navLinks.classList.contains('active')){
        navLinks.querySelector('a').focus();
      }
    });
    // Ferme le menu au scroll ou tap hors menu
    document.addEventListener('click',function(e){
      if(navLinks.classList.contains('active')&&!mobileMenu.contains(e.target)&&!navLinks.contains(e.target)){
        navLinks.classList.remove('active');
        mobileMenu.classList.remove('active');
        document.body.style.overflow='auto';
      }
    });
    window.addEventListener('scroll',function(){
      if(navLinks.classList.contains('active')){
        navLinks.classList.remove('active');
        mobileMenu.classList.remove('active');
        document.body.style.overflow='auto';
      }
    });
    // Accessibilité clavier mobile (fermeture ESC)
    navLinks.querySelectorAll('a').forEach(function(link){
      link.addEventListener('keydown',function(e){
        if(e.key==='Escape'){
          navLinks.classList.remove('active');
          mobileMenu.classList.remove('active');
          document.body.style.overflow='auto';
          mobileMenu.focus();
        }
      });
    });
  }
});